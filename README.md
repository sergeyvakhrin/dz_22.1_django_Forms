Задание 1
Продолжаем работать с проектом из предыдущего домашнего задания. Для модели продуктов реализуйте механизм CRUD, задействовав модуль 
django.forms
.

Условия для пользователей:

могут создавать новые продукты,
не могут создавать продукты с запрещенными словами в названии и описании.
Для исключения загрузки запрещенных продуктов реализуйте валидацию названия и описания продукта таким образом, чтобы нельзя было в них добавлять слова: казино, криптовалюта, крипта, биржа, дешево, бесплатно, обман, полиция, радар.

Для настройки валидации внутри формы определите методы 
clean
 для полей (например, 
clean_name()
). При наличии запрещенных слов — выбрасывайте ошибку 
forms.ValidationError()
 с соответствующим сообщением. Если валидация проходит успешно, возвращайте 
cleaned_data
.

Задание 2
Добавьте новую модель «Версия», которая должна содержать следующие поля:

продукт,
номер версии,
название версии,
признак текущей версии.
При наличии активной версии реализуйте вывод в список продуктов информации об активной версии.

Признак текущей версии — булево поле, является ли версия для продукта текущей для отображения на сайте или нет.

Для отображения активной версии расширьте метод 
get_context_data()
 контроллера списка продуктов, получите данные о версиях продукта и выберите текущую (активную) версию для продукта.

Задание 3
Добавьте реализацию работы с формами для версий продукта.

Примечание

Все созданные формы нужно стилизовать так, чтобы они были в единой стилистике оформления всей платформы. Для этого можно воспользоваться методом 
__init__
 либо самостоятельно изучить пакет crispy-forms.

При стилизации формы методом 
__init__
 можно создать класс-миксин для сокращения дублирования кода.

Для стилизации булевого поля используйте специальный стиль — 
form-check-input
.

Дополнительное задание
В один момент может быть только одна активная версия продукта, поэтому при изменении версий необходимо проверять, что пользователь в качестве активной версии указал только одну. В случае возникновения ошибки вернуть сообщение пользователю и попросить выбрать только одну активную версию.

Дополнительное задание, помеченное звездочкой, желательно, но не обязательно выполнять.


####################### 22.2 ############################

Задание 1
Создайте новое приложения для работы с пользователем. Определите собственную модель для пользователя, при этом задайте электронную почту как поле для авторизации.

Также добавьте поля:

аватар,
номер телефона,
страна.
Не забудьте откатить миграции приложения 
auth
 до внесения изменений в настройки проекта и переопределения модели для авторизации. Если этого не сделать, вы не сможете взаимодействовать с базой данных. Чтобы откатить миграции приложения 
auth
, можно воспользоваться командой 
python manage.py migrate auth zero

Задание 2
В сервисе реализуйте функционал аутентификации, а именно:

Регистрация пользователя по почте и паролю.
Создайте контроллер для регистрации, который будет взаимодействовать с формой регистрации — пользователю достаточно ввести почту и пароль.

Верификация почты пользователя через отправленное письмо.
В контроллере регистрации переопределите метод 
form_valid()
 и встройте автоматическую отправку электронного сообщения пользователю на указанный в форме регистрации адрес.

Для отправки электронной почты воспользуйтесь встроенной в Django функцией 
send_mail()
.

Не забудьте настроить почтовый сервер, через который будет происходить отправка электронной почты.

Документацию можно найти тут.

Авторизация пользователя.
Создайте отдельный контроллер для авторизации (
LoginView
) и зарегистрируйте его в приложении.

Восстановление пароля зарегистрированного пользователя на автоматически сгенерированный пароль.
Создайте новый контроллер для восстановления пароля.

В интерфейсе кнопка «Восстановить пароль» должна отображаться на странице входа.

Пользователь вводит адрес электронной почты, в контроллере происходит генерация пароля, перезапись пароля для пользователя с соответсвующим адресом электронной почты и отправка сообщения с новым паролем на адрес почты.

Пароль можно сгенерировать с помощью библиотеки 
random
.

Помните, что пароль в базе данных хранится в захешированном виде. Для установки пароля пользователю можно воспользоваться функцией 
make_password()
 (посмотреть в документации про эту функцию).

Задание 3
Все контроллеры, которые отвечают за работу с продуктами, закройте для анонимных пользователей, при этом создаваемые продукты должны автоматически привязываться к авторизованному пользователю.

Чтобы закрыть контроллеры от анонимных пользователей, добавьте в CBV-контроллеры дополнительное наследование от 
LoginRequiredMixin
 (документация здесь).

Не забудьте добавить поле для продуктов, которое будет указывать на владельца. Оно должно быть ссылкой на модель пользователя.

Для автоматической привязки пользователя к продукту переопределите в контроллере создания продукта метод 
form_valid()
.

Текущий авторизованный пользователь доступен через 
self.request.user
 — запишите его в только что созданный продукт и не забудьте сохранить объект в базу данных.

Дополнительное задание
Добавьте интерфейс редактирования профиля пользователя.

Дополнительное задание, помеченное звездочкой, желательно, но не обязательно выполнять.

##################### 23.1 ###########################

Задание 1
Создайте группу для роли модератора и опишите необходимые доступы:

может отменять публикацию продукта,
может менять описание любого продукта,
может менять категорию любого продукта.
Группу создавайте в админке. Права доступа для продуктов опишите в модели продукта и назначьте группе через админку. Не забудьте сохранить группы фикстурой или создать команду для создания групп для отправки наставнику на проверку.

Примечание

Недостающее поле признака публикации необходимо добавить таким образом, чтобы можно было определять статус продукта. Можно использовать 
BooleanField
 со значением 
False
 по умолчанию или 
CharField
 с указанием вариантов значений (
choises
). При этом по умолчанию должен быть вариант, который не предполагает публикации продукта.

Подсказка
Задание 2
Реализуйте решение, которое проверит, что редактирование продукта доступно только его владельцу.

Внедрите в шаблоны проверку на владельца объекта и отображайте кнопки редактирования только пользователям, которые являются владельцами (если пользователь не наделен другими правами).

Дополнительное задание
Выделите отдельную роль для пользователя — контент-менеджера, который может управлять публикациями в блоге. Также не забудьте реализовать проверки на то, что обычный пользователь или модератор из другого отдела не сможет ничего изменить в разделе блога.

Дополнительное задание, помеченное звездочкой, желательно, но не обязательно выполнять.

###################### 23.2 ############################

Задание 1
Продолжаем работать с проектом. Установите брокер для кеширования Redis. Внесите необходимые настройки и проверьте работоспособность проекта с новыми настройками.

Обратите внимание на то, что Redis не работает на Windows. Для запуска используйте WSL Linux (вы устанавливали его ранее). Инструкцию можно найти здесь.

После проведения настроек Redis будет доступен для использования по адресу 127.0.0.1:6379, если вы не меняли порт для запуска. Если порт был изменен, указывайте тот, на котором запущен процесс.

Задание 2
Настройте кеширование всего контроллера отображения данных относительно одного продукта.

Примечание

Помните, что кеширование можно подключать не только в файле views.py, но и в файле маршрутизации urls.py. Важно делать всё в одном месте, чтобы достичь единообразия в коде проекта и не запутаться впоследствии.

Задание 3
Создайте сервисную функцию, которая будет отвечать за выборку категорий и которую можно переиспользовать в любом месте системы. Добавьте низкоуровневое кеширование для списка категорий.

Также можно реализовать функцию для кеширования списка продуктов. Если вы не использовали категории в своей работе, реализуйте контроллер и шаблон для выдачи списка категорий и в качестве контекста передавайте результат работы этой функции. Также можно воспользоваться переопределением кверисета в CBV.

Задание 4
Вынесите необходимые настройки в переменные окружения и настройте проект для работы с ними.

К необходимым настройкам относятся все чувствительные данные, которые хранятся в настройках приложения: секретный ключ Django, настройки базы данных, настройки кеширования (адрес подключения к брокеру, включение кеширования), включение режима отладки и любые логины и пароли от сторонних сервисов, например данные учетной записи для отправки почты. Любые данные, которые могут при утечке навредить вашему приложению и являются чувствительными.

Дополнительное задание

Добавьте кеширование всего сайта целиком, при этом отключите от кеширования определенные контроллеры, которые отвечают за работу по заполнению продуктов и блога.

Дополнительное задание, помеченное звездочкой, желательно, но не обязательно выполнять.